= content_for :title, "#{@show.name} (#{@show.start_date.year})"
= content_for :javascripts do
  = javascript_include_tag 'favorite'
  = javascript_include_tag 'seasons-list'

.container-fluid{style: 'background: #333; color: white; padding: 30px 0;'}
  .container
    .row
      .col-md-3
        = image_tag @show.photo, style: 'width: 100%'
        - if user_signed_in?
          %button.btn-watch-status.btn.btn-info.dropdown-toggle{type: 'button', 'data-toggle': "dropdown", 'aria-haspopup': "true", 'aria-expanded': "false"} Статус
          .dropdown-menu
            = link_to (I18n.t 'user.dont-watch'), change_status_show_path(@show, status: :dont_watch), class: 'dropdown-item'
            = link_to (I18n.t 'user.will-watch'), change_status_show_path(@show, status: :will_watch), class: 'dropdown-item'
            = link_to (I18n.t 'user.watching'), change_status_show_path(@show, status: :watching), class: 'dropdown-item'
            = link_to (I18n.t 'user.stopped-watch'), change_status_show_path(@show, status: :stopped_watch), class: 'dropdown-item'

          = link_to (I18n.t 'comment.add'), new_show_comment_path(@show), class: 'btn-watch-comment btn btn-warning'

      .col-lg-9
        %h1.films-title
          .films-title-left
            = @show.name
            %span.text-muted= "(#{@show.start_date.year})"
          - if current_user.present?
            .films-title-right
              %label.bookmarks{title: 'Додати в закладки', 'data-id': @show.id}
                %input{type: 'checkbox', checked: @user_show&.favorite}
                %span.bookmarks-status
        %h5
          - @show_genres.each do |genre|
            = link_to genre.name, genre, class: 'badge badge-info'

        %b= (I18n.t 'show.status') + ':'
        - if @show.status == 'Run'
          %span.badge.badge-success= @show.status
        - else
          %span.badge.badge-danger= @show.status
        %br
        %b= (I18n.t 'show.start-date') + ':'
        = @show.start_date.strftime('%d.%m.%Y')
        %br
        %b= (I18n.t 'show.finish-date') + ':'
        - if @show.finish_date.nil?
          = '...'
        - else
          = @show.finish_date.strftime('%d.%m.%Y')
        %br
        %b= (I18n.t 'show.seasons') + ':'
        = @show.seasons_count
        %br
        %b= (I18n.t 'show.runtime') + ':'
        = @show.runtime.to_s + ' min.'
        %br
        %b= (I18n.t 'show.rate-imdb') + ':'
        - if @show.rate_imdb == nil
          = 'Not rated yet'
        - else
          = @show.rate_imdb
        %br
        %b= 'Загальна оцінка:'
        = rating_for @show, 'rate'
        - if user_signed_in?
          %b= 'Ваша оцінка:'
          = rating_for_user @show, current_user, 'rate', :star => 7
        %b= (I18n.t 'show.about') + ':'
        = @show.about
        %br

.container.pt16
  .row.justify-content-center
    .col-md-9


      -#%button.tiny.button.dropdown.show-status{'data-dropdown' => 'drop1', 'aria-controls' => 'drop1', 'aria-expanded' => 'false'}
      -#  - unless @current_fav.blank?
      -#    - case @current_fav.show_status
      -#      - when 'dont_watch'
      -#        = I18n.t 'user.dont-watch'
      -#      - when 'watching'
      -#        = I18n.t 'user.watching'
      -#      - when 'will_watch'
      -#        = I18n.t 'user.will-watch'
      -#      - when 'stopped_watch'
      -#        = I18n.t 'user.stopped-watch'
      -#  - else
      -#    = I18n.t 'user.dont-watch'


      .accordion#accordionSeason
        - count = @show.episodes.last.season
        - i = 0
        - while count > i do
          - current_season = @show_episodes.where(:season => count)
          .card
            .card-header
              %h5.mb-0
                %button.btn.btn-link{type: 'button', 'data-toggle': 'collapse', 'data-target': "#collapse-#{count}", 'aria-expanded': 'true', 'aria-controls': "collapse-#{count}"}= (I18n.t 'show.season') + ' ' + count.to_s
            .collapse.show{'aria-labelledby': 'heading-1', 'data-parent': '#accordionSeason', id: "collapse-#{count}"}
              .card-body
                %table.table.table-striped
                  %tr
                    %th{width: '50px'}= '#'
                    %th{width: '530px'}= I18n.t 'show.name'
                    %th{width: '50px'}= I18n.t 'show.date'
                  - current_season.each do |episode|
                    %tr
                      %td= episode.season.to_s + 'x' + episode.number.to_s
                      %td= link_to episode.name, episode
                      - if episode.released <= DateTime.now
                        %td
                          %span.badge.badge-success= episode.released.strftime('%d.%m.%Y')
                      - else
                        %td
                          %span.badge.badge-secondary= episode.released.strftime('%d.%m.%Y')
          - count -= 1

      -#%ul.seasons
      -#  - count = @show.episodes.last.season
      -#  - i = 0
      -#  - while count > i do
      -#    - current_season = @show_episodes.where(:season => count)
      -#    %li.closeable.close
      -#      %h6= (I18n.t 'show.season') + ' ' + count.to_s
      -#      %table.table.table-striped
      -#        %tr
      -#          %th{width: '50px'}= '#'
      -#          %th{width: '530px'}= I18n.t 'show.name'
      -#          %th{width: '50px'}= I18n.t 'show.date'
      -#        - current_season.each do |episode|
      -#          %tr
      -#            %td= episode.season.to_s + 'x' + episode.number.to_s
      -#            %td= link_to episode.name, episode
      -#            - if episode.released <= DateTime.now
      -#              %td
      -#                %span.success.label.radius= episode.released.strftime('%d.%m.%Y')
      -#            - else
      -#              %td
      -#                %span.secondary.label.radius= episode.released.strftime('%d.%m.%Y')
      -#    - count -= 1


      .media
        = render :partial => 'comments/comment', :collection => @show.comments

    -#.col-lg-3.col-md-4.col-sm-12.closeable.recommendation
    -#  %h6= I18n.t 'show.recommend'
    -#  - @recommendation.each do |item|
    -#    - if @show != item
    -#      = link_to (image_tag item.photo), item
    -#      = link_to item.name, item
